
/**
 * lulutia
 * Version: 0.0.1
 * Copyright 2015 - 2015 
 */
 define(function(require,a,b){"use strict";var c,d;return d={},c=require("echarts"),d.init=function(){return d.maping(),d.getData(),d.eventBind()},d.maping=function(){return this.mapCity={SH:"上海",BJ:"北京",GZ:"广州"}},d.getData=function(){return $.ajax({type:"get",url:"./data/test.json",dataType:"json",success:function(a,b){var c,e,f,g,h,i;for(c={NAME:["SH","BJ","GZ"],SH:[],BJ:[],GZ:[],DATE:[]},i=a.Sheet1,f=e=0,h=i.length;h>e;f=++e)g=i[f],c.SH.push(parseFloat(g.上海)),c.BJ.push(parseFloat(g.北京)),c.GZ.push(parseFloat(g.广州)),c.DATE.push(g.日期);return d.initChart(c)},error:function(a,b){return console.log(b)}})},d.eventBind=function(){return $("#J-nav li").click(function(){return $(this).parent().find("li").removeClass("active"),$(this).addClass("active"),d.getData()}),$("#J-circlenav li").click(function(){return $(this).parent().find("li").removeClass("active"),$(this).addClass("active"),d.getData()})},d.initChart=function(a){var b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(b={min:0,ave:0,max:0},e={min:0,ave:0,max:0},f={min:0,ave:0,max:0},z=a.BJ,i=0,r=z.length;r>i;i++)g=z[i],100>g?b.min++:g>100&&200>g?b.ave++:b.max++;for(A=a.GZ,k=0,s=A.length;s>k;k++)h=A[k],100>h?e.min++:h>100&&200>h?e.ave++:e.max++;for(B=a.SH,l=0,t=B.length;t>l;l++)F=B[l],100>F?f.min++:F>100&&200>F?f.ave++:f.max++;for(this.airchart=c.init(document.getElementById("air_chart")),this.airpie=c.init(document.getElementById("airpie_chart")),D=[],q=[],C=a.NAME,m=0,u=C.length;u>m;m++)j=C[m],E={},E.name=d.mapCity[j],E.type=$("#J-nav li.active").attr("value").toString(),E.smooth=!0,E.data=a[j],E.markPoint={data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},E.markLine={data:[{type:"average",name:"平均值"}]},q.push(d.mapCity[j]),D.push(E);return v={title:{text:"北京，上海，广州三城市空气质量图",subtext:"部分数据"},tooltip:{show:!0,trigger:"axis"},legend:{data:q},xAxis:[{type:"category",boundaryGap:!1,axisTick:{show:!0,interval:0},data:a.DATE}],yAxis:[{type:"value"},{type:"value"}],series:D},this.airchart.setOption(v),w={title:{text:"AQI数据分析图",subtext:"数据来自PM25.in",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["AQI<100","100<AQI<200","AQI>200"]},series:[{name:"北京空气质量占比",type:"pie",radius:"55%",center:["17%","60%"],data:[{value:b.min,name:"AQI<100"},{value:b.ave,name:"100<AQI<200"},{value:b.max,name:"AQI>200"}]},{name:"上海空气质量占比",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:f.min,name:"AQI<100"},{value:f.ave,name:"100<AQI<200"},{value:f.max,name:"AQI>200"}]},{name:"广州空气质量占比",type:"pie",radius:"55%",center:["85%","60%"],data:[{value:e.min,name:"AQI<100"},{value:e.ave,name:"100<AQI<200"},{value:e.max,name:"AQI>200"}]}]},p={normal:{label:{show:!0,position:"center",formatter:"{b}",textStyle:{baseline:"bottom"}},labelLine:{show:!1}}},o={normal:{label:{formatter:function(a){return(100*(1-a.value)).toFixed(2)+"%"},textStyle:{baseline:"top"}}}},n={normal:{color:"#ccc",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}},y=[50,75],x={title:{text:"AQI数据分析图",subtext:"数据来自PM25.in",x:"center"},series:[{name:"北京空气质量占比",type:"pie",center:["15%","60%"],radius:y,x:"0%",itemStyle:o,data:[{name:"other",value:(b.min+b.ave)/a.BJ.length,itemStyle:n},{name:"北京: AQI>200",value:b.max/a.BJ.length,itemStyle:p}]},{name:"上海空气质量占比",type:"pie",center:["50%","60%"],radius:y,x:"20%",itemStyle:o,data:[{name:"other",value:(f.min+f.ave)/a.SH.length,itemStyle:n},{name:"上海: AQI>200",value:f.max/a.SH.length,itemStyle:p}]},{name:"广州空气质量占比",type:"pie",center:["85%","60%"],radius:y,x:"40%",itemStyle:o,data:[{name:"other",value:(e.min+e.ave)/a.GZ.length,itemStyle:n},{name:"广州: AQI>200",value:e.max/a.GZ.length,itemStyle:p}]}]},"circle"===$("#J-circlenav li.active").attr("value")?this.airpie.setOption(x):this.airpie.setOption(w)},b.exports=d});