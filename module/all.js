
/**
 * lulutia
 * Version: 0.0.1
 * Copyright 2015 - 2015 
 */
 define(function(require,a,b){"use strict";var c,d;return c={},d=require("echarts"),c.init=function(){return c.getData()},c.getData=function(){return $.ajax({type:"get",url:"./data/country.json",dataType:"json",success:function(a,b){return c.dataHandle(a)}})},c.eventBind=function(){return $("#J-allnav li").click(function(){var a;return $(this).parent().find("li").removeClass("active"),$(this).addClass("active"),$(".J-info").addClass("hidden"),a=$("#J-allnav li.active").attr("value"),$("#"+a).removeClass("hidden").addClass("block"),c.airbarchart.clear(),c.itemall=[],c.itemallname=[],c.itemradio=[],c.dataProcess(c.allType)}),this.airchart.on("click",function(a){return c.airbarinit(a)})},c.airbarinit=function(a){var b,e,f,g,h;return b=null!=a?c.allType.area.indexOf(a.name):309,c.itemall=c.itemall||[],c.itemradio=c.itemradio||[],c.itemall.length<5?(c.itemallname=c.itemallname||[],c.itemallname.push(c.allType.area[b]),e={name:c.allType.area[b],type:"bar",data:[c.allType.aqi[b],c.allType.pm2_5[b],c.allType.pm10[b],c.allType.co[b],c.allType.no2[b],c.allType.o3[b],c.allType.so2[b]]},c.itemall.push(e),f={value:[c.allType.aqi[b],c.allType.pm2_5[b],c.allType.pm10[b],c.allType.co[b],c.allType.no2[b],c.allType.o3[b],c.allType.so2[b]],name:c.allType.area[b]},c.itemradio.push(f),this.airbarchart=d.init(document.getElementById("airbar_chart")),g={title:{text:"所选地区情况",subtext:"数据取自PM25.in,此处最多选择五个"},tooltip:{trigger:"axis"},legend:{data:c.itemallname},xAxis:[{type:"category",data:["aqi","PM2.5","PM10","CO","NO2","O3","SO2"]}],yAxis:[{type:"value"}],series:c.itemall},this.airbarchart.setOption(g),this.airradiochart=d.init(document.getElementById("airradio_chart")),h={title:{text:"所选地区情况",subtext:"数据取自PM25.in,此处最多选择五个"},tooltip:{trigger:"axis"},legend:{orient:"vertical",x:"right",y:"bottom",data:c.itemallname},polar:[{indicator:[{text:"空气质量（AQI）",max:309},{text:"细颗粒物（PM2.5）",max:258},{text:"可吸入颗粒物（PM10）",max:267},{text:"一氧化碳（CO）",max:3},{text:"二氧化氮（NO2）",max:101},{text:"臭氧（O3）",max:174},{text:"二氧化硫（SO2）",max:169}]}],calculable:!0,series:[{name:"所选地区情况",type:"radar",data:c.itemradio}]},this.airradiochart.setOption(h)):void 0},c.dataHandle=function(a){var b,d,e,f,g,h,i;for(c.allType={},b=0,h=a.length;h>b;b++)for(d=a[b],g=Object.keys(d),e=0,i=g.length;i>e;e++)f=g[e],c.allType[f]=c.allType[f]||[],c.allType[f].push(d[f]);return c.dataProcess(c.allType)},c.dataProcess=function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p;for(p=$("#J-allnav li.active").attr("value").toString(),o=[],g={name:p,type:"map",mapType:"china",hoverable:!1,roam:!0,data:[],markPoint:{symbolSize:5,itemStyle:{normal:{borderColor:"#87cefa",borderWidth:1,label:{show:!1}},emphasis:{borderColor:"#1e90ff",borderWidth:5,label:{show:!1}}},data:[]}},c.max=0,m=a[p],e=d=0,i=m.length;i>d;e=++d)b=m[e],k={},k.name=a.area[e],k.value=b,k.value>c.max&&(c.max=k.value),g.markPoint.data.push(k);if(null!=c.geocoord)return g.geoCoord=c.geocoord,o.push(g),c.initChart(o);for(c.geocoord={},n=a.area,h=0,j=n.length;j>h;h++)f=n[h],c.ajaxt(f),c.flag=a.area.length;l=setInterval(function(a){return function(){return 0===c.flag?(g.geoCoord=c.geocoord,o.push(g),c.initChart(o),clearInterval(l)):void 0}}(this),100)},c.ajaxt=function(a){return $.ajax({type:"get",url:"http://api.map.baidu.com/geocoder/v2/",dataType:"jsonp",data:{output:"json",ak:"ZXhtdkazbuOxPmG6xB0609zB",address:a},success:function(b,d){return 0===b.status?(c.geocoord[a]=[],c.geocoord[a].push(b.result.location.lng),c.geocoord[a].push(b.result.location.lat)):(c.geocoord[a].push(0),c.geocoord[a].push(0)),c.flag--}})},c.initChart=function(a){var b;return this.airchart=d.init(document.getElementById("airall_chart")),b={title:{text:"全国空气质量("+$("#J-allnav li.active").find("a").html()+")",subtext:"数据取自PM25.in"},dataRange:{min:0,max:c.max,calculable:!0,color:["maroon","purple","red","orange","yellow","lightgreen"]},tooltip:{trigger:"item"},series:a},this.airchart.setOption(b),c.airbarinit(),c.eventBind()},b.exports=c});